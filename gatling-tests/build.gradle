plugins {
    id 'java'
    id 'io.gatling.gradle' version '3.10.3'
}

repositories {
    mavenCentral()
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

gatling {
    // Gatling simulations configuration
    simulations = {
        include "**/OrderFlowSimulation.java"
        include "**/InventorySpikeTest.java"
    }
}

dependencies {
    gatling 'io.gatling.highcharts:gatling-charts-highcharts:3.10.3'
    gatling 'io.gatling:gatling-app:3.10.3'
    gatling 'io.gatling:gatling-recorder:3.10.3'
}

// Task to run specific simulation
task runOrderFlowTest(type: JavaExec) {
    description = 'Run Order Flow Simulation'
    mainClass = 'io.gatling.app.Gatling'
    classpath = sourceSets.gatling.runtimeClasspath
    args = [
        '--simulation', 'com.bitvelocity.performance.OrderFlowSimulation',
        '--results-folder', 'build/reports/gatling'
    ]
}
